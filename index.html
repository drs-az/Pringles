<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#ffcc66" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Pringle123" />
  <link rel="apple-touch-icon" href="pringle.png" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <title>Pringle 1, 2, 3</title>
  <style>
    :root{--bg:#0b0b0c;--panel:#151518;--ink:#fafafa;--muted:#bdbdbd;--accent:#ffcc66;--accent2:#ffd991;--ok:#7bffb5}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 1200px at 50% -200px,#1b1b1f 0,#0b0b0c 65%);color:var(--ink);
         font:500 16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
         display:flex;align-items:center;justify-content:center;padding:22px}
    .app{width:min(820px,100%);background:var(--panel);border:1px solid #22232a;border-radius:22px;padding:20px 18px 16px;
         box-shadow:0 30px 80px rgba(0,0,0,.45);position:relative;overflow:hidden}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
    h1{margin:0;font-size:22px}
    .muted{color:var(--muted)}
    .chip-wrap{display:grid;place-items:center;padding:10px 0 2px}
    .chip-btn{appearance:none;background:none;border:0;cursor:pointer;padding:0;transition:transform .08s ease-out;touch-action:manipulation}
    .chip-btn:active{transform:scale(.975) rotate(-.3deg)}
    .chip{width:min(78vw,420px);filter:drop-shadow(0 14px 22px rgba(0,0,0,.55)) drop-shadow(0 2px 4px rgba(0,0,0,.35));display:block}
    .stats{margin:6px 2px 10px;display:grid;gap:8px}
    .card{background:#0e0f12;border:1px solid #23242c;border-radius:16px;padding:12px 14px;display:grid;gap:8px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .controls{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap;align-items:center}
    button.ctrl{background:#1a1b21;color:#fff;border:1px solid #2c2d36;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
    button.primary{background:var(--accent);color:#161616;border-color:#f2c35e}
    footer{margin-top:10px;color:#9a9aa0;font-size:13px;text-align:center}
    .tiny{font-size:12px;color:#a7a7a7}
    .badges{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .badge{background:#1a1b21;border:1px solid #2c2d36;border-radius:8px;padding:4px 8px;font-size:14px}
    /* FULL-SCREEN confetti canvas */
    #fxCanvas{position:fixed;inset:0;pointer-events:none;z-index:5}
    .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#121317;border:1px solid #2b2c34;
      color:#e7ffe7;padding:10px 14px;border-radius:12px;box-shadow:0 12px 30px rgba(0,0,0,.4);display:none;z-index:10}
    .toast.show{display:block}
  </style>
</head>
<body>
  <canvas id="fxCanvas"></canvas>
  <div class="app" id="app">
    <header>
      <h1>Pringle 1, 2, 3</h1>
      <div class="muted tiny">Tap the chip to add one</div>
    </header>

    <div class="chip-wrap">
      <button id="chipBtn" class="chip-btn" aria-label="Add one Pringle">
        <img src="pringle.png" class="chip" alt="Pringle chip"/>
      </button>
    </div>

    <section class="stats">
      <div class="card">
        <div class="row"><div>Pringles eaten</div><strong id="count">0</strong></div>
        <div>Calories (10.7 each): <strong id="calories">0.0</strong> kcal</div>
        <div>Sodium (12.9 mg each): <strong id="sodium">0.0</strong> mg</div>
      </div>
      <div class="card" id="badgesCard" hidden>
        <div>Badges unlocked:</div>
        <div class="badges" id="badges"></div>
      </div>
      <div class="controls">
        <button id="undoBtn" class="ctrl">−1</button>
        <button id="resetBtn" class="ctrl">Reset</button>
        <button id="shareBtn" class="ctrl">Share</button>
        <button id="installBtn" class="ctrl primary" hidden>Install App</button>
        <span class="tiny" id="hint" aria-live="polite"></span>
      </div>
    </section>

    <footer>Works offline. Progress is saved automatically.</footer>
    <div class="toast" id="toast"></div>
  </div>

  <script>
    // --- constants
    const CAL_PER=10.7, SOD_MG=12.9;
    const $=s=>document.querySelector(s);
    const els={count:$('#count'),cal:$('#calories'),sod:$('#sodium'),chip:$('.chip'),
      installBtn:$('#installBtn'),toast:$('#toast'),hint:$('#hint'),
      badges:$('#badges'),badgesCard:$('#badgesCard')};

    // state
    let count=Number(localStorage.getItem('p123_count')||0);
    let badges=JSON.parse(localStorage.getItem('p123_badges')||'[]');
    function update(){els.count.textContent=count; els.cal.textContent=(count*CAL_PER).toFixed(1);
      els.sod.textContent=(count*SOD_MG).toFixed(1); localStorage.setItem('p123_count',String(count));}
    function renderBadges(){ if(badges.length===0){els.badgesCard.hidden=true; return;}
      els.badgesCard.hidden=false;
      els.badges.innerHTML=badges.map(b=>`<span class="badge">${b}</span>`).join(''); }
    update(); renderBadges();

    const quips=[
      "Your dedication to crunch is alarming.",
      "Hope you brought napkins.",
      "The potato gods salute you.",
      "Sodium? Never heard of her.",
      "You're the reason the can has a warning label."
    ];
    function celebrate(){
      if(count===84 && !badges.includes('Can Crusher')){
        badges.push('Can Crusher');
        localStorage.setItem('p123_badges',JSON.stringify(badges));
        renderBadges();
        toast('🛢️ Can Crusher! 84 chips — an entire can annihilated!');
      } else if(count>0 && count%10===0){
        const label=`${count} chips`;
        if(!badges.includes(label)){
          badges.push(label);
          localStorage.setItem('p123_badges',JSON.stringify(badges));
          renderBadges();
          const quip=quips[Math.floor(Math.random()*quips.length)];
          toast(`🎖️ ${label}! ${quip}`);
        }
      }
    }

    // interactions
    $('#chipBtn').addEventListener('click',()=>{count++; update(); crunch(); spawnConfetti(); celebrate();});
    $('#undoBtn').addEventListener('click',()=>{count=Math.max(0,count-1); update();});
    $('#resetBtn').addEventListener('click',()=>{ if(confirm('Reset to 0?')){count=0; update(); badges=[]; localStorage.removeItem('p123_badges'); renderBadges();}});

    // share (text fallback)
    $('#shareBtn').addEventListener('click', async ()=>{
      const text = `Today I ate ${count} Pringle${count===1?'':'s'} — Calories: ${(count*CAL_PER).toFixed(1)} kcal; Sodium: ${(count*SOD_MG).toFixed(1)} mg`;
      if(navigator.share){ try{ await navigator.share({title:'Pringle 1, 2, 3', text}); }catch{} }
      else { try{ await navigator.clipboard.writeText(text); toast('Copied to clipboard.'); }catch{} }
    });
    function toast(msg){els.toast.textContent=msg; els.toast.classList.add('show'); setTimeout(()=>els.toast.classList.remove('show'),1500);}

    // sound via WebAudio
    let AC=null; document.addEventListener('pointerdown',()=>{ if(!AC){const C=window.AudioContext||window.webkitAudioContext; if(C) AC=new C();}}, {once:true});
    function crunch(){ if(!AC) return; const t=AC.currentTime;
      const makeNoise=(dur, f, Q, hp, peak, atk)=>{const N=Math.floor(AC.sampleRate*dur), buf=AC.createBuffer(1,N,AC.sampleRate), d=buf.getChannelData(0);
        for(let i=0;i<N;i++){let v=(Math.random()*2-1)*1.25; d[i]=Math.max(-1,Math.min(1,v));}
        const src=AC.createBufferSource(); src.buffer=buf; const bp=AC.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=f; bp.Q.value=Q;
        const hpF=AC.createBiquadFilter(); hpF.type='highpass'; hpF.frequency.value=hp||600; const g=AC.createGain();
        g.gain.setValueAtTime(0.001,t); g.gain.exponentialRampToValueAtTime(peak,t+(atk||0.01)); g.gain.exponentialRampToValueAtTime(0.001,t+dur);
        src.connect(bp); bp.connect(hpF); hpF.connect(g); g.connect(AC.destination); src.start(t); src.stop(t+dur+0.02);};
      makeNoise(0.16,2500,1.2,700,0.9,0.012); makeNoise(0.07,4200,1.8,0,0.6,0.006);
      const osc=AC.createOscillator(); const g3=AC.createGain(); osc.type='triangle'; osc.frequency.setValueAtTime(3200,t);
      g3.gain.setValueAtTime(0.001,t); g3.gain.exponentialRampToValueAtTime(0.2,t+0.003); g3.gain.exponentialRampToValueAtTime(0.001,t+0.05);
      osc.connect(g3); g3.connect(AC.destination); osc.start(t); osc.stop(t+0.06);
    }

    // FULL-SCREEN Confetti (simple yellow dots for perf)
    const fx=document.getElementById('fxCanvas'); const ctx=fx.getContext('2d');
    const dpr=Math.max(1, window.devicePixelRatio||1);
    function resizeCanvas(){ fx.width=Math.floor(window.innerWidth*dpr); fx.height=Math.floor(window.innerHeight*dpr);
      fx.style.width=window.innerWidth+'px'; fx.style.height=window.innerHeight+'px'; ctx.setTransform(dpr,0,0,dpr,0,0); }
    window.addEventListener('resize', resizeCanvas); resizeCanvas();

    let parts=[]; let raf=0;
    function spawnConfetti(n=120){
      const r=els.chip.getBoundingClientRect();
      const ox=r.left + r.width/2; const oy=r.top + r.height/2; // viewport coords
      for(let i=0;i<n;i++){
        const ang=Math.random()*Math.PI*2, sp=3+Math.random()*4;
        parts.push({x:ox,y:oy,vx:Math.cos(ang)*sp,vy:Math.sin(ang)*sp-2,g:0.12+Math.random()*0.06,life:0,ttl:900+Math.random()*300});
      }
      if(!raf){ raf=requestAnimationFrame(loop); }
    }
    function loop(){
      raf=requestAnimationFrame(loop);
      ctx.clearRect(0,0,fx.width/dpr,fx.height/dpr);
      parts=parts.filter(p=>{
        p.life+=16; if(p.life>p.ttl) return false;
        p.vy+=p.g; p.x+=p.vx; p.y+=p.vy;
        ctx.fillStyle='#ffcc66'; ctx.beginPath(); ctx.arc(p.x,p.y,3,0,6.283); ctx.fill();
        return p.x>-40 && p.x<fx.width/dpr+40 && p.y<fx.height/dpr+60;
      });
      if(parts.length===0){ cancelAnimationFrame(raf); raf=0; }
    }

    // PWA install & SW
    let deferredPrompt=null;
    window.addEventListener('beforeinstallprompt',e=>{e.preventDefault(); deferredPrompt=e; document.getElementById('installBtn').hidden=false;});
    document.getElementById('installBtn').addEventListener('click', async ()=>{ if(!deferredPrompt) return; document.getElementById('installBtn').hidden=true; deferredPrompt.prompt(); try{await deferredPrompt.userChoice;}catch{} deferredPrompt=null; });
    window.addEventListener('load', ()=>{ if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js'); } });
  </script>
</body>
</html>
